{"version":3,"file":"bundle.js","sources":["../src/doc/5.发布订阅模式/4.发布订阅模式实战.ts","../src/main.ts"],"sourcesContent":["// 1. 定义 EventEmitter 类\r\ntype EventHandler = (...args: any[]) => any\r\n\r\nclass EventEmitter {\r\n    private c = new Map<string, EventHandler[]>();\r\n\r\n    // 订阅指定的主题\r\n    subscribe(topic: string, ...handlers: EventHandler[]) {\r\n        let topics = this.c.get(topic);\r\n        if(!topics){\r\n\r\n            this.c.set(topic, topics = [])\r\n        }\r\n        topics.push(...handlers);\r\n\r\n    }\r\n    unsubscribe(topic:string,handler?:EventHandler){\r\n        if(!handler){\r\n            return this.c.delete(topic)\r\n        }\r\n        const topics = this.c.get(topic)\r\n        if(!topics){\r\n            return  false;\r\n        }\r\n        const index = topics.indexOf(handler)\r\n        if(index<0){\r\n            return  false;\r\n        }\r\n        topics.splice(index,1);\r\n        if(topics.length === 0){\r\n            this.c.delete(topic)\r\n        }\r\n        return  true;\r\n    }\r\n\r\n    publish(topic:string,...args:any[]):any[]|null{\r\n        const topics = this.c.get(topic);\r\n        if(!topics){\r\n            return  null;\r\n        }\r\n        return topics.map(handler=>{\r\n            try {\r\n                return handler(...args)\r\n            }catch (e){\r\n                console.log(e)\r\n                return null;\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\n\r\nexport {\r\n    EventEmitter\r\n}\r\n\r\n","import {EventEmitter} from \"./doc/5.发布订阅模式/4.发布订阅模式实战\";\r\n\r\n\r\nconst eventEmitter = new EventEmitter();\r\n// 订阅\r\neventEmitter.subscribe(\"ts\",(msg)=>{\r\n    console.log(`收到订阅的信息: ${msg}`);\r\n});\r\n// 多个地方订阅\r\neventEmitter.subscribe(\"ts\",(msg1)=>{\r\n    console.log(`第二次订阅:收到订阅的信息: ${msg1}`);\r\n});\r\n// 推送\r\neventEmitter.publish('ts',\"第一次推送\")\r\n// 取消订阅\r\neventEmitter.unsubscribe(\"ts\");\r\neventEmitter.publish('ts',\"第二次推送\")\r\n;(window as any).eventEmitter= eventEmitter;"],"names":[],"mappings":";;;IAGA,MAAM,YAAY;QAAlB;YACY,MAAC,GAAG,IAAI,GAAG,EAA0B,CAAC;SA6CjD;;QA1CG,SAAS,CAAC,KAAa,EAAE,GAAG,QAAwB;YAChD,IAAI,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YAC/B,IAAG,CAAC,MAAM,EAAC;gBAEP,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,EAAE,MAAM,GAAG,EAAE,CAAC,CAAA;aACjC;YACD,MAAM,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC,CAAC;SAE5B;QACD,WAAW,CAAC,KAAY,EAAC,OAAqB;YAC1C,IAAG,CAAC,OAAO,EAAC;gBACR,OAAO,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;aAC9B;YACD,MAAM,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;YAChC,IAAG,CAAC,MAAM,EAAC;gBACP,OAAQ,KAAK,CAAC;aACjB;YACD,MAAM,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;YACrC,IAAG,KAAK,GAAC,CAAC,EAAC;gBACP,OAAQ,KAAK,CAAC;aACjB;YACD,MAAM,CAAC,MAAM,CAAC,KAAK,EAAC,CAAC,CAAC,CAAC;YACvB,IAAG,MAAM,CAAC,MAAM,KAAK,CAAC,EAAC;gBACnB,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAA;aACvB;YACD,OAAQ,IAAI,CAAC;SAChB;QAED,OAAO,CAAC,KAAY,EAAC,GAAG,IAAU;YAC9B,MAAM,MAAM,GAAG,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YACjC,IAAG,CAAC,MAAM,EAAC;gBACP,OAAQ,IAAI,CAAC;aAChB;YACD,OAAO,MAAM,CAAC,GAAG,CAAC,OAAO;gBACrB,IAAI;oBACA,OAAO,OAAO,CAAC,GAAG,IAAI,CAAC,CAAA;iBAC1B;gBAAA,OAAO,CAAC,EAAC;oBACN,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAA;oBACd,OAAO,IAAI,CAAC;iBACf;aACJ,CAAC,CAAA;SACL;;;IC7CL,MAAM,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC;IACxC;IACA,YAAY,CAAC,SAAS,CAAC,IAAI,EAAC,CAAC,GAAG;QAC5B,OAAO,CAAC,GAAG,CAAC,YAAY,GAAG,EAAE,CAAC,CAAC;IACnC,CAAC,CAAC,CAAC;IACH;IACA,YAAY,CAAC,SAAS,CAAC,IAAI,EAAC,CAAC,IAAI;QAC7B,OAAO,CAAC,GAAG,CAAC,kBAAkB,IAAI,EAAE,CAAC,CAAC;IAC1C,CAAC,CAAC,CAAC;IACH;IACA,YAAY,CAAC,OAAO,CAAC,IAAI,EAAC,OAAO,CAAC,CAAA;IAClC;IACA,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;IAC/B,YAAY,CAAC,OAAO,CAAC,IAAI,EAAC,OAAO,CAAC,CACjC;IAAC,MAAc,CAAC,YAAY,GAAE,YAAY;;;;;;"}